# 楓之谷自動化腳本 (C# WinForms)

**作者：** SchwarzeKatze_R

**版本：** 1.0.4

**開發語言：** C# (.NET WinForms)

## 📖 專案簡介

此專案為基於 C# 開發的楓之谷自動化輔助工具，提供錄製與播放鍵盤動作的功能。透過 **Windows API (P/Invoke)** 實現底層按鍵注入，支援「前景模擬」與「背景訊息發送」兩種模式，並具備即時圖形化日誌監控系統。


## 專案介面
<img width="695" height="633" alt="image" src="https://github.com/user-attachments/assets/e7904429-1a58-4687-a352-22ef79ee2c8f" />





## ⚡ 功能特色

* **錄製與播放：** 採用全域鍵盤鉤子 (Keyboard Hook)，精確擷取按鍵動作與時間間隔。
* **雙模式支援：**
* **前景模式：** 透過 `keybd_event` 模擬真實物理按鍵。
* **背景模式：** 透過 PostMessage 與 AttachThreadInput 嘗試將鍵盤訊息發送至指定視窗（依目標程式實作而有差異）。

* **JSON 腳本化：** 動作序列儲存為 JSON 格式，方便分享、載入或手動編輯按鍵數值。
* **即時 Log 顯示：** 使用 GDI+ 在介面上繪製即時運作狀態，包含按鍵代碼與剩餘播放時間。
* **視窗鎖定：** 支援關鍵字自動搜尋或從運行清單中手動選取目標遊戲視窗。

## 🛠️ 環境需求

* **作業系統：** Windows 10 / 11
* **執行架構：** [ .NET 8 (Windows, WinForms)](https://builds.dotnet.microsoft.com/dotnet/Runtime/8.0.23/dotnet-runtime-8.0.23-win-x64.exe)
* **權限要求：** **必須以系統管理員身分執行**（否則無法攔截與發送高權限視窗的按鍵訊息）。

## ⚠️ 需要注意 (Important)

1. **背景執行切換方式：**
* 若要使用背景執行，請在**腳本持續按住方向鍵**時切換視窗（例如 Alt+Tab 或點擊其他視窗）。
* 這樣可讓腳本保持方向鍵狀態並正常在背景持續運作。

2. **方向鍵干擾排除：**
* 由於 Windows 訊息機制的特性，播放「上、下、左、右」方向鍵時仍可能影響目前正在操作的前景視窗，程式會嘗試排除。

3. **按鍵支援限制：**
* 目前版本 **「背景模式」暫時不支援 ALT 鍵及insert、home、delete、end、pageup、pagedown**。若你的腳本中有用到這些按鍵，請改用前景模式執行。



## ▶️ 操作說明

1. **管理員權限啟動**：右鍵點擊程式，選擇「以系統管理員身分執行」。
2. **鎖定遊戲視窗**：
* 點擊「重新整理視窗」自動抓取標題含「MapleStory」的視窗。
* 或使用「鎖定視窗」從清單中手動選取。

3. **錄製與編輯**：
* 點擊「開始錄製」後直接在鍵盤操作。
* 錄製結束後可點擊「編輯事件」微調按鍵延遲。

4. **播放腳本**：
* 設定循環次數，點擊「開始播放」。
* **記得點開記事本並讓它保持在最前方**，以確保操作不受方向鍵干擾。



## 📅 更新紀錄
### 2025/09/23 (v1.0.4)
* 新增背景切換提示（不阻塞腳本）
* 改善停止播放後按鍵釋放邏輯
* 調整背景切換行為，保持按鍵狀態以符合手動切換

### 2026/01/30 (v1.0.3)
* 新增播放全局熱鍵
* UI SKIN介面更動
* 介面說明改動
* 按鈕布局更改

### 2026/01/20 (v1.0.2)
* 修正讀取存檔後無法觸發「開始播放」按鈕

### 2026/01/20 (v1.0.1)
* 更新按鍵映射說明

### 2026/01/20 (v1.0.0)

* 正式轉換至 C# WinForms 框架。
* 新增背景模式發送邏輯 (PostMessage)。
* 新增 GDI+ 繪製的黑客風格即時LOG視窗。
* 優化掃描碼 (Scan Code) 映射，提高方向鍵觸發率。

## 🐛 已知限制

* 背景模式下 ALT 鍵暫時失效。
* 錄製時若同時切換視窗，可能會擷取到非預期的系統按鍵。

## ⚠️ 重要聲明

* 本工具僅供 **技術研究與個人學習** 之用。
* 使用自動化腳本可能違反遊戲服務條款（ToS），存在帳號被停權等相關風險。
* 使用者需自負使用本程式後產生的一切後果。

## 📄 授權

本專案採用 [MIT License](https://github.com/kuroneko11375/MapleMacro-Ver.C-/blob/master/LICENSE.txt) 授權條款。

