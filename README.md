# 楓之谷自動化腳本 (C# WinForms)

**作者：** SchwarzeKatze_R

**版本：** 1.1.0

**開發語言：** C# (.NET 8, WinForms)

## 📖 專案簡介

此專案為基於 C# 開發的楓之谷自動化輔助工具，提供錄製與播放鍵盤動作的功能。透過 **Windows API (P/Invoke)** 實現底層按鍵注入，支援「前景模擬」與「背景訊息發送」兩種模式，並具備即時圖形化日誌監控系統。

## 專案介面
<img width="678" height="628" alt="image" src="https://github.com/user-attachments/assets/994d7641-b3c9-466a-a4cc-1b068e25d4b0" />

## ⚡ 功能特色

### 🎯 核心功能
* **錄製與播放：** 採用全域鍵盤鉤子 (Keyboard Hook)，精確擷取按鍵動作與時間間隔。
* **JSON 腳本化：** 動作序列儲存為 JSON 格式，方便分享、載入或手動編輯。
* **視窗鎖定：** 支援關鍵字自動搜尋或從運行清單中手動選取目標遊戲視窗。

### 🎮 雙模式支援
* **前景模式：** 透過 `SendInput` API 模擬真實物理按鍵（更可靠）。
* **背景模式：** 透過 `PostMessage` 與 `AttachThreadInput` 將鍵盤訊息發送至指定視窗。

### ⌨️ 方向鍵發送模式（三種可選）
  | 模式 | 說明 |
  |------|------|
  | **S2C (背景)** | ThreadAttach + PostMessage，純背景走路用 |
  | **TAB** | ThreadAttach + Blocker，嘗試避免影響前景 |
  | **SWB (推薦)** | SendInput + Blocker，預設模式，較穩定 |

### ⚡ 自定義按鍵系統（15 格）
* 設定最多 15 個自定義按鍵，在腳本播放時按間隔自動觸發
* 支援設定：
  - **間隔秒數**：每隔幾秒觸發一次
  - **開始時間**：腳本播放幾秒後開始觸發
  - **暫停腳本**：觸發前暫停主腳本
  - **延遲等待**：按鍵後等待（適用於技能施放）

### 🔥 全局熱鍵
* **F9**：開始播放（預設）
* **F10**：停止播放（預設）
* 可在設定中自訂熱鍵

### ⏰ 定時執行
* 設定指定時間自動開始播放腳本
* 即時顯示倒數計時

### 📊 執行統計
* 記錄總循環次數、執行時間
* 追蹤各自定義按鍵觸發次數

### 💾 設定管理
* 自動儲存/載入設定
* 支援設定檔匯入/匯出
* 設定檔位置：`%AppData%\MapleMacro\settings.json`

## 🛠️ 環境需求

* **作業系統：** Windows 10 / 11
* **執行架構：** [.NET 8 Runtime (Windows)](https://dotnet.microsoft.com/download/dotnet/8.0)
* **權限要求：** **必須以系統管理員身分執行**（否則無法攔截與發送高權限視窗的按鍵訊息）

## ⚠️ 需要注意 (Important)

1. **方向鍵模式選擇：**
   * **SWB 模式（預設推薦）**：使用 SendInput + 鍵盤阻擋器，較穩定
   * **TAB 模式**：使用 ThreadAttach + 鍵盤阻擋器
   * **S2C 模式**：純背景模式，適合走路腳本

2. **按鍵支援說明：**
   * 背景模式下 **Alt 鍵** 使用特殊發送方式處理
   * 方向鍵、Insert、Delete 等延伸鍵會自動使用適當的發送方式

## ▶️ 操作說明

1. **管理員權限啟動**：右鍵點擊程式，選擇「以系統管理員身分執行」

2. **鎖定遊戲視窗**：
   * 點擊「重新整理視窗」自動抓取標題含「MapleStory」的視窗
   * 或使用「鎖定視窗」從清單中手動選取（支援雙擊快速選擇）

3. **錄製與編輯**：
   * 點擊「開始錄製」後直接在鍵盤操作
   * 錄製結束後可點擊「編輯事件」微調或刪除按鍵

4. **設定自定義按鍵**（可選）：
   * 點擊「自定義按鍵」設定技能等週期性按鍵
   * 設定間隔、開始時間、暫停與延遲參數

5. **播放腳本**：
   * 設定循環次數
   * 點擊「開始播放」或按 F9 熱鍵
   * 按 F10 或點擊「停止播放」結束

6. **進階設定**：
   * 點擊「熱鍵設定」自訂播放/停止熱鍵及方向鍵模式
   * 點擊「定時執行」設定排程
   * 點擊「統計」查看執行數據

## 📅 更新紀錄

### 2026/02/06 (v1.1.0_V4)
* 小幅更新攔截語法
* 分離全域與腳本副檔名，可兼容舊版本

### 2026/02/06 (v1.1.0)
* 新增 **自定義按鍵系統**（15 格槽位）
* 改用 **SendInput API** 作為前景模式主要發送方式（更可靠）
* 預設方向鍵模式改為 **SWB（推薦）**
* 程式碼清理與優化

### 2025/02/04 (v1.0.4)
* 新增背景切換提示（不阻塞腳本）
* 改善停止播放後按鍵釋放邏輯
* 調整背景切換行為，保持按鍵狀態以符合手動切換

### 2025/01/30 (v1.0.3)
* 新增播放全局熱鍵
* UI SKIN 介面更動
* 介面說明改動
* 按鈕布局更改

### 2025/01/20 (v1.0.2)
* 修正讀取存檔後無法觸發「開始播放」按鈕

### 2025/01/20 (v1.0.1)
* 更新按鍵映射說明

### 2025/01/20 (v1.0.0)
* 正式轉換至 C# WinForms 框架
* 新增背景模式發送邏輯 (PostMessage)
* 新增 GDI+ 繪製的黑客風格即時 LOG 視窗
* 優化掃描碼 (Scan Code) 映射，提高方向鍵觸發率

## 🐛 已知限制

* 背景模式下 Alt 鍵可能不穩定（已使用特殊處理）
* 錄製時若同時切換視窗，可能會擷取到非預期的系統按鍵
* 部分遊戲可能有反外掛機制，背景模式可能失效

## ⚠️ 重要聲明

* 本工具僅供 **技術研究與個人學習** 之用。
* 使用自動化腳本可能違反遊戲服務條款（ToS），存在帳號被停權等相關風險。
* 使用者需自負使用本程式後產生的一切後果。

## 📄 授權

本專案採用 [MIT License](https://github.com/kuroneko11375/MapleMacro-Ver.C-/blob/master/LICENSE.txt) 授權條款。


